<!DOCTYPE html>
<html lang="en">
<head>
<title>Chess</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="Description" content="Chess">
<link rel="stylesheet" href="bootstrap_3_3_7.css">
<!--
used svg images from:
https://commons.wikimedia.org/wiki/Category:SVG_chess_pieces
600pxx600px for 75px 
float: left;
-->
<style>
.header{text-align: center; color: white; background-color: #BB4E1A;}
.undo{margin-left: auto; margin-right: auto; max-width: 100px; max-height: 100px; text-align: center; margin-bottom: 20px; color:white; background-color: rgb(53, 78, 145);}
.black_move_number{margin-left: auto; margin-right: auto; max-width: 100px; max-height: 100px; text-align: center; margin-bottom: 20px; color:black; background-color: white;}
.white_move_number{margin-left: auto; margin-right: auto; max-width: 100px; max-height: 100px; text-align: center; margin-bottom: 20px; color:white; background-color: black}

.column{
float: left;
width: 50%;
}
.side_column{
float: left;
width: 25%;
}
.row:after{
content: "";
display: table;
clear: both;
}
.grid-container{
max-width: 480px;
max-height: 480px;
margin-left: auto; 
margin-right: auto;
grid-template-areas:
"_8A _8B _8C _8D _8E _8F _8G _8H"
"_7A _7B _7C _7D _7E _7F _7G _7H"
"_6A _6B _6C _6D _6E _6F _6G _6H"
"_5A _5B _5C _5D _5E _5F _5G _5H"
"_4A _4B _4C _4D _4E _4F _4G _4H"
"_3A _3B _3C _3D _3E _3F _3G _3H"
"_2A _2B _2C _2D _2E _2F _2G _2H"
"_1A _1B _1C _1D _1E _1F _1G _1H"
;}
._8A{grid-area: _8A;}
._8B{grid-area: _8B;}
._8C{grid-area: _8C;}
._8D{grid-area: _8D;}
._8E{grid-area: _8E;}
._8F{grid-area: _8F;}
._8G{grid-area: _8G;}
._8H{grid-area: _8H;}
._7A{grid-area: _7A;}
._7B{grid-area: _7B;}
._7C{grid-area: _7C;}
._7D{grid-area: _7D;}
._7E{grid-area: _7E;}
._7F{grid-area: _7F;}
._7G{grid-area: _7G;}
._7H{grid-area: _7H;}
._6A{grid-area: _6A;}
._6B{grid-area: _6B;}
._6C{grid-area: _6C;}
._6D{grid-area: _6D;}
._6E{grid-area: _6E;}
._6F{grid-area: _6F;}
._6G{grid-area: _6G;}
._6H{grid-area: _6H;}
._5A{grid-area: _5A;}
._5B{grid-area: _5B;}
._5C{grid-area: _5C;}
._5D{grid-area: _5D;}
._5E{grid-area: _5E;}
._5F{grid-area: _5F;}
._5G{grid-area: _5G;}
._5H{grid-area: _5H;}
._4A{grid-area: _4A;}
._4B{grid-area: _4B;}
._4C{grid-area: _4C;}
._4D{grid-area: _4D;}
._4E{grid-area: _4E;}
._4F{grid-area: _4F;}
._4G{grid-area: _4G;}
._4H{grid-area: _4H;}
._3A{grid-area: _3A;}
._3B{grid-area: _3B;}
._3C{grid-area: _3C;}
._3D{grid-area: _3D;}
._3E{grid-area: _3E;}
._3F{grid-area: _3F;}
._3G{grid-area: _3G;}
._3H{grid-area: _3H;}
._2A{grid-area: _2A;}
._2B{grid-area: _2B;}
._2C{grid-area: _2C;}
._2D{grid-area: _2D;}
._2E{grid-area: _2E;}
._2F{grid-area: _2F;}
._2G{grid-area: _2G;}
._2H{grid-area: _2H;}
._1A{grid-area: _1A;}
._1B{grid-area: _1B;}
._1C{grid-area: _1C;}
._1D{grid-area: _1D;}
._1E{grid-area: _1E;}
._1F{grid-area: _1F;}
._1G{grid-area: _1G;}
._1H{grid-area: _1H;}
.shell{margin-left: auto; margin-right: auto;}
body{margin: auto; background:rgba(111, 125, 121, 0.66);}
.footer{background-color: #444e5f;}
/*
@media screen and (max-width: 1125px){.grid-container{transform: scale(0.80);transition: transform .2s;}}
&nbsp&nbsp&nbsp&nbsp
*/
</style>
</head>
<body>
<div class="header"><h1>Chess</h1></div>
<div class="row">
<div class="side_column"><div class="black_move_number" id="black_move_number">0</div></div>
<div class="column"><div class="undo" id="undo">undo</div></div>
<div class="side_column"><div class="white_move_number" id="white_move_number">0</div></div>
</div>



<div class="shell">
<div id="base" class="grid-container"></div>
</div>
<div class="footer"></div>
<script>
var base = document.getElementById("base");
var wmn_count = 0;
var bmn_count = 0;
var wmn = document.getElementById("white_move_number");
var bmn = document.getElementById("black_move_number");

var board = {
"_8A":"black_rook",
"_8B":"black_knight",
"_8C":"black_bishop",
"_8D":"black_queen",
"_8E":"black_king",
"_8F":"black_bishop",
"_8G":"black_knight",
"_8H":"black_rook",
"_7A":"black_pawn",
"_7B":"black_pawn",
"_7C":"black_pawn",
"_7D":"black_pawn",
"_7E":"black_pawn",
"_7F":"black_pawn",
"_7G":"black_pawn",
"_7H":"black_pawn",
"_6A":"marker",
"_6B":"marker",
"_6C":"marker",
"_6D":"marker",
"_6E":"marker",
"_6F":"marker",
"_6G":"marker",
"_6H":"marker",
"_5A":"marker",
"_5B":"marker",
"_5C":"marker",
"_5D":"marker",
"_5E":"marker",
"_5F":"marker",
"_5G":"marker",
"_5H":"marker",
"_4A":"marker",
"_4B":"marker",
"_4C":"marker",
"_4D":"marker",
"_4E":"marker",
"_4F":"marker",
"_4G":"marker",
"_4H":"marker",
"_3A":"marker",
"_3B":"marker",
"_3C":"marker",
"_3D":"marker",
"_3E":"marker",
"_3F":"marker",
"_3G":"marker",
"_3H":"marker",
"_2A":"white_pawn",
"_2B":"white_pawn",
"_2C":"white_pawn",
"_2D":"white_pawn",
"_2E":"white_pawn",
"_2F":"white_pawn",
"_2G":"white_pawn",
"_2H":"white_pawn",
"_1A":"white_rook",
"_1B":"white_knight",
"_1C":"white_bishop",
"_1D":"white_queen",
"_1E":"white_king",
"_1F":"white_bishop",
"_1G":"white_knight",
"_1H":"white_rook"
}


var innerhtml = {
"_8A":'<img src="black_rook.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_8B":'<img src="black_knight.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_8C":'<img src="black_bishop.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_8D":'<img src="black_queen.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_8E":'<img src="black_king.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_8F":'<img src="black_bishop.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_8G":'<img src="black_knight.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_8H":'<img src="black_rook.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_7A":'<img src="black_pawn.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_7B":'<img src="black_pawn.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_7C":'<img src="black_pawn.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_7D":'<img src="black_pawn.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_7E":'<img src="black_pawn.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_7F":'<img src="black_pawn.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_7G":'<img src="black_pawn.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_7H":'<img src="black_pawn.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_6A":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_6B":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_6C":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_6D":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_6E":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_6F":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_6G":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_6H":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_5A":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_5B":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_5C":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_5D":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_5E":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_5F":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_5G":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_5H":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_4A":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_4B":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F"/>',
"_4C":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_4D":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F"/>',
"_4E":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_4F":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F"/>',
"_4G":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_4H":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F"/>',
"_3A":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F"/>',
"_3B":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_3C":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F"/>',
"_3D":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_3E":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F"/>',
"_3F":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_3G":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F"/>',
"_3H":'<img src="grey.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_2A":'<img src="white_pawn.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_2B":'<img src="white_pawn.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_2C":'<img src="white_pawn.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_2D":'<img src="white_pawn.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_2E":'<img src="white_pawn.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_2F":'<img src="white_pawn.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_2G":'<img src="white_pawn.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_2H":'<img src="white_pawn.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_1A":'<img src="white_rook.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_1B":'<img src="white_knight.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_1C":'<img src="white_bishop.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_1D":'<img src="white_queen.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_1E":'<img src="white_king.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_1F":'<img src="white_bishop.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>',
"_1G":'<img src="white_knight.png" style="width:60px;height:60px; background-color: #B79C7F;"/>',
"_1H":'<img src="white_rook.png" style="width:60px;height:60px; background-color: #7F9AB7;"/>'
}

var white_graveyard = {};

var black_graveyard = {};

var game = [];
var move_number = 0;
game[0]=board;
var front_game = [];
front_game[0]=innerhtml;

var moves = [];

var black_square = ["_8A","_8C","_8E","_8G","_7B","_7D","_7F","_7H","_6A","_6C","_6E","_6G","_5B","_5D","_5F","_5H","_4A","_4C","_4E","_4G","_3B","_3D","_3F","_3H","_2A","_2C","_2E","_2G","_1B","_1D","_1F","_1H"]

var whose_turn = 0;
var lock_by_mod=move_number%2;;

var selected;
var selected_color;
var last_selected = "init";
var last_selected_color;
var last_selected_id;
//var from = "";
//var to = "";
//var turn = 1;
var itr = 0;
//var from_color = "";
//var to_color = "";
//var from_itr = 0;
//var white_turn = 1;
//var black_turn = 0;
var undo=0;


/*
var game = {
grid_square:piece or empty_marker
all grids
player: white and black
piece counter


TO DO:: !!!

when capturing a piece don't replicate : inject black space to from

also insert marker to board



recoginize valid moves

matrix to frontend mapping function



sucessive captures at the same location causes an error

js events, css, and html.  I made it like a world.  
Right now it only has rules for what players turn it is, to ignore empty spaces, and that a player canâ€™t take their own pieces.  
I need to make the different piece classes, special case handling, win detection, feedback, graveyard for taken pieces, 
back / forward buttons, computer player, online vs, possible move feedback.



*/
function show_moves(board)
{

}

//function get_piece(classname)
//{
//var out = JSON.stringify(board[classname]);
//console.log("board.classname: " + out);
//return out;
//}

function log_game()
{
var i = 1;
while(i<move_number){
console.log("game[i]: " + diff(game[i],game[i-1]));
console.log("front_game[i]: " + diff(front_game[i],front_game[i-1]));
i++;
}

}


function log_turn()
{


game[move_number]=board;
front_game[move_number]=innerhtml;
console.log("move_number: " + move_number);
if(move_number>0){
//var test1 = {a:"a",b:"c"};
//var test2 = {"a":"a","b":"b"};
//diff(test1,test2);
diff(game[move_number-1],board);
diff(front_game[move_number-1],innerhtml);
}
//console.log("game[move_number]: " + JSON.stringify(game[move_number]));
//console.log("front_game[move_number]: " + JSON.stringify(front_game[move_number]));
}

function diff(json1,json2)
{
var equal=0;
var diff = {};
for(key in json1){
if(key in json2){
if(json1[key] != json2[key]){diff[key]=json1[key] + " != " + json2[key];}
else{equal=1;}
}
}
if(equal == 1){diff[key]="same";}
console.log(JSON.stringify(diff));
}

function take_back()
{
if(undo == 0)
{
//&& wmn_count > bmn_count

//if(bmn_count > wmn_count){bmn_count--; bmn.innerHTML=bmn_count; leave("black_move_number"); hover("white_move_number");}
//else if(bmn_count == wmn_count){wmn_count--; wmn.innerHTML=wmn_count; leave("white_move_number"); hover("black_move_number");}

//&& wmn_count == bmn_count    if(move_number-1%2 == 0)
//diff(innerhtml,front_game[move_number]);

//&& undo == 0

//undo++;
//moves[move_number]=[from_ele,to_ele,from_id,to_id,"move"];
if(moves[move_number][4] == "move"){move_piece(moves[move_number][0],moves[move_number][1],moves[move_number][2],moves[move_number][3],moves[move_number][5],moves[move_number][6]);}
else{take_piece(moves[move_number][0],moves[move_number][1],moves[move_number][2],moves[move_number][3],moves[move_number][5],moves[move_number][6]);}
undo=1;
//if(whose_turn == 1){whose_turn=0;}
//whose_turn=1;
if(move_number>0){
//if(bmn_count > wmn_count){whose_turn=0; bmn_count--; bmn.innerHTML=bmn_count; leave("black_move_number"); hover("white_move_number");}
//else if(bmn_count == wmn_count){whose_turn=1; wmn_count--; wmn.innerHTML=wmn_count; leave("white_move_number"); hover("black_move_number");}
}
if(move_number>0){move_number--;}
//diff(innerhtml,front_game[move_number]);

//innerhtml=front_game[move_number];
//board=game[move_number];
//console.log("move_number: " + move_number);
//console.log("board: " + JSON.stringify(board));
//console.log("front_game[move_number]: " + JSON.stringify(front_game[move_number]));
}
// update frontend??
//lamda_gen("mod");
//if(type != "init"){var ele = document.getElementById(key); ele.innerHTML = innerhtml[key];}
//var key;
//for(key in innerhtml){
//var ele = document.getElementById(key); 
//ele.innerHTML = innerhtml[key];
//}


}


function is_b(id)
{
var is_b = black_square.includes(id);
return is_b;
}


function w_b_m(id)
{
var p_class = document.getElementById(id);
var piece = JSON.stringify(board[p_class.className]);
var player = piece.slice(1,2);
console.log(player);
if(player == "b"){return "b";}
if(player == "w"){return "w";}
if(player == "m"){return "m";}
}

//swap_piece(out2,in2,out2.className,in2.className);
//function swap_piece(l_to,l_from,to,from)
//swap_piece(out2,in2,out2.id,in2.id);

function move_piece(to_ele,from_ele,to_id,from_id,in2,out2)
{
//var from_class = document.getElementById(from);
//var from_piece = JSON.stringify(board[from]);
//console.log(from_ele);
//console.log(to_ele);
//console.log(from_id);
//console.log(to_id);
//if(to == "start")
//console.log(innerhtml[from_id]);
//console.log(innerhtml[to_id]);
move_number++;
moves[move_number]=[from_ele,to_ele,from_id,to_id,"move",in2,out2];

from_color = w_b_m(from_id);
to_color = w_b_m(to_id);

//  need to fix destination background colors !!

//if(to_color != "m"){console.log(innerhtml[to]);}

// only sway piece string !!!


var here = innerhtml[from_id].indexOf(".png");
var there = innerhtml[to_id].indexOf(".png");
var player1 = innerhtml[from_id].slice(10,here);
var player2 = innerhtml[to_id].slice(10,there);
//var swap_temp = innerhtml[from]


innerhtml[to_id] = innerhtml[to_id].replace(player2, player1);


//var from_bg_color = innerhtml[from_id].slice(-13,-4);
//var to_bg_color = innerhtml[to_id].slice(-13,-4);
//console.log("to_bg_color: " + to_bg_color);
//console.log("from_bg_color: " + from_bg_color);
//console.log("player2: " + player2);
//console.log("to_color: " + to_color);

//from_bg_color = toString(from_bg_color);
//player2 = toString(player2);
if(to_color == "m"){
var is_b = black_square.includes(from_id);
if(is_b){console.log("blank swap1"); innerhtml[from_id] = innerhtml[from_id].replace(player1, "grey");}
if(!is_b){console.log("blank swap2"); innerhtml[from_id] = innerhtml[from_id].replace(player1, "brown");}
//console.log("m");
}



//to_id


//var from_bg_color = black_square.find(function(element){return element == from_id;});
//var to_bg_color = black_square.find(function(element){return element == to_id;});
/*

console.log("player1: " + player1);
console.log("player2: " + player2);
console.log("innerhtml[from_id]: " + innerhtml[from_id]);
console.log("to_bg_color: " + to_bg_color);
console.log("from_bg_color: " + from_bg_color);




console.log("from_bg_color: " + from_bg_color);
console.log("to_bg_color: " + to_bg_color);


if(player2 == "gray"){
if(from_bg_color == "7F9AB7"){innerhtml[from_id] = innerhtml[from_id].replace(player1, "grey");}
if(from_bg_color == "B79C7F"){innerhtml[from_id] = innerhtml[from_id].replace(player1, "brown");}
console.log("to_bg_color: " + to_bg_color);
console.log("player2: " + player2);
console.log("innerhtml[to_id]: " + innerhtml[to_id]);
console.log("player1: " + player1);
}
if(player2 == "brown"){
if(from_bg_color == "B79C7F"){innerhtml[from_id] = innerhtml[from_id].replace(player1, "brown");}
if(from_bg_color == "7F9AB7"){innerhtml[from_id] = innerhtml[from_id].replace(player1, "gray");}
console.log("to_bg_color: " + from_bg_color);
console.log("player2: " + player2);
console.log("innerhtml[to_id]: " + innerhtml[to_id]);
console.log("player1: " + player1);
}


if(player1 == "gray"){
if(to_bg_color == "7F9AB7"){innerhtml[from_id] = innerhtml[from_id].replace(player1, "grey");}
console.log("to_bg_color: " + to_bg_color);
console.log("player2: " + player2);
console.log("innerhtml[from_id]: " + innerhtml[from_id]);
console.log("player1: " + player1);
} 
if(player1 == "brown"){
if(to_bg_color == "B79C7F"){innerhtml[from_id] = innerhtml[from_id].replace(player1, "brown");}
console.log("to_bg_color: " + from_bg_color);
console.log("player2: " + player2);
console.log("innerhtml[from_id]: " + innerhtml[from_id]);
console.log("player1: " + player1);
}
*/





from_ele.innerHTML = innerhtml[from_id];
to_ele.innerHTML = innerhtml[to_id];
console.log("from_ele.innerHTML: " + from_ele.innerHTML);
console.log("to_ele.innerHTML: " + to_ele.innerHTML);
//board[from_id] = board[to_id];
//board[to_id] = board[from_id];
//console.log("board[from_id]: " + board[from_id]);
//console.log("board[to_id]: " + board[to_id]);
//from = "";
//to = "";
//turn = 0;
//from_color = "";
//to_color = "";

//return player1,player2;

//lamda_link('base',innerhtml[from_id],from_id,from_id);
//lamda_link('base',innerhtml[to_id],to_id,to_id);

//var from_class = document.getElementById(from);
//var from_piece = JSON.stringify(board[from_class.className]);
//var resp = newURL.slice(here);
//console.log(player);
//if(player == "b"){return "b";}
//if(player == "w"){return "w";}
//if(player == "m"){return "m";}

//var temp = board;
board[in2.id] = selected;
board[out2.id] = last_selected;
//diff(temp,board);
console.log("board[from_id]: " + board[in2.id]);
console.log("board[to_id]: " + board[out2.id]);
log_turn()
console.log("whose_turn: " + whose_turn);
if(whose_turn == 1){whose_turn=0;}
else{whose_turn=1;}
console.log("whose_turn: " + whose_turn);
console.log('inside : selected == "marker"');

if(lock_by_mod == 0){bmn_count++; bmn.innerHTML=bmn_count; leave("black_move_number"); hover("white_move_number");}
if(lock_by_mod == 1){wmn_count++; wmn.innerHTML=wmn_count; leave("white_move_number"); hover("black_move_number");}





}



//lamda_link('base',innerhtml['_8A'],'_8A','_8A');  
function lamda_gen(type)
{
//while(base.firstChild){console.log(base.firstChild + "removed"); base.removeChild(base.firstChild);}

var key;
for(key in innerhtml){
//function sleep (time){return new Promise((resolve) => setTimeout(resolve, time));}
//sleep(500000).then(() => {});
//basename,innerhtml,id,classname

if(type == "init"){lamda_link('base',innerhtml[key],key,key);}

//console.log("innerhtml[key]: " + JSON.stringify(innerhtml[key]));
//console.log("key: " + key);
}
}


// to_ele,from_ele,to_id,from_id
function take_piece(to_ele,from_ele,to_id,from_id,in2,out2)
{

move_number++;
moves[move_number]=[from_ele,to_ele,from_id,to_id,"take",in2,out2];

from_color = w_b_m(from_id);
to_color = w_b_m(to_id);

var here = innerhtml[from_id].indexOf(".png");
var there = innerhtml[to_id].indexOf(".png");
var player1 = innerhtml[from_id].slice(10,here);
var player2 = innerhtml[to_id].slice(10,there);
//var from_bg_color = innerhtml[from_id].slice(-13,-4);
//var to_bg_color = innerhtml[to_id].slice(-13,-4);

innerhtml[to_id] = innerhtml[to_id].replace(player2, player1);

//#7F9AB7;"/>',
//"_6H":'<img src="brown.png" style="width:60px;height:60px; background-color: #B79C7F;

//if(from_bg_color == "#7F9AB7"){
var is_b = black_square.includes(from_id);
if(is_b){console.log("grey.png"); innerhtml[from_id] = innerhtml[from_id].replace(player1, "grey");}
if(!is_b){console.log("brown.png"); innerhtml[from_id] = innerhtml[from_id].replace(player1, "brown");}


// move piece img to taken at side of player

from_ele.innerHTML = innerhtml[from_id];
to_ele.innerHTML = innerhtml[to_id];
console.log("from_ele.innerHTML: " + from_ele.innerHTML);
console.log("to_ele.innerHTML: " + to_ele.innerHTML);
//board[to_id] = board[from_id];
//board[from_id] = "marker";
//console.log("board[from_id]: " + board[from_id]);
//console.log("board[to_id]: " + board[to_id]);


//var temp = board;
board[in2.id] = "marker";
board[out2.id] = last_selected;
//diff(temp,board);
console.log("board[from_id]: " + board[in2.id]);
console.log("board[to_id]: " + board[out2.id]);
log_turn();
console.log("whose_turn: " + whose_turn);
if(whose_turn == 1){whose_turn=0;}
else{whose_turn=1;}
//console.log("whose_turn: " + whose_turn);
//console.log('inside : last_selected_color != selected_color');



if(lock_by_mod == 0){bmn_count++; bmn.innerHTML=bmn_count; leave("black_move_number"); hover("white_move_number");}
if(lock_by_mod == 1){wmn_count++; wmn.innerHTML=wmn_count; leave("white_move_number"); hover("black_move_number");}

}


function hover(id){
//var out = document.getElementById(infoid);
//out.style.display = "block";
//out.style = "visibility: visible;";
//width:100px; height:100px; z-index: 999;transform: scale(1.1); transition: transform .2s; 
var out2 = document.getElementById(id);
out2.style = "outline-style: solid; outline-color: #CBD3EE; cursor: pointer;";
}
function leave(id){
//var out = document.getElementById(infoid);
//out.style = "visibility: hidden;";
var out2 = document.getElementById(id);
out2.style = "z-index: 2;transform: scale(1);";
}




lamda_gen("init");
//leave("black_move_number");
hover("black_move_number");

//function lamda_link(basename,innerhtml,id,url,classname,infoid,infoclass,infoinnerhtml)
function lamda_link(basename,innerhtml,id,classname)
{
var base = document.getElementById(basename);
//var ddiv2 = document.createElement("div");
//ddiv2.className = classname;
//ddiv2.innerHTML = boardcolor;
//base.appendChild(ddiv2);
var ddiv = document.createElement("lamda_link");
ddiv.innerHTML = innerhtml;
ddiv.id = id;
ddiv.className = classname;
//if(black_square.includes(classname)){ddiv.style = "background-color: #7F9AB7;";}
//else{ddiv.style = "background-color: #B79C7F;";}

//ddiv.select = classname;
base.appendChild(ddiv);
//board.classname = 


function execute_z(id){
//call function
var out2 = document.getElementById(id);
//var name = out2.className;
//console.log("className: " + out2.className);
//var piece = get_piece(out2.className);
console.log(itr);

if(itr != 0){
last_selected = selected;
last_selected_color = selected_color;
}
selected = board[out2.id];
selected_color = w_b_m(id);


//if(itr != 0){}
console.log("last_selected: " + last_selected);
console.log("selected: " + selected);




if(whose_turn == 1){console.log("whose_turn: black");}
if(whose_turn == 0){console.log("whose_turn: white");}

//moved_color = w_b_m(id);

//var mod_turn=0;
lock_by_mod = move_number%2;
//if(move_number != 0){if(lock_by_mod > 0){mod_turn=0}else{mod_turn=1}}
console.log("lock_by_mod: " + lock_by_mod);
//console.log("mod_turn: " + mod_turn);


//console.log("selected: " + selected);
//console.log("selected_color: " + selected_color);
console.log("whose_turn " + whose_turn + " && last_selected_color " + last_selected_color + " last_selected " + last_selected);
if((whose_turn == 1 && last_selected_color == "b" && lock_by_mod == 1) || (whose_turn == 0 && last_selected_color == "w" && lock_by_mod == 0) && (last_selected != "marker") && (last_selected != selected) && (last_selected != "init")){

console.log("inside exe");



//if(selected == out2.className && piece != "marker"){


//if(itr != 0){to_color = w_b_m(id); console.log("to_color: " + to_color);}

//if(last_selected != "marker" && itr != 0 && selected != "marker" && turn != 0 && to_color != last_selected_color){


//if(last_selected != "marker" && itr != 0 && to_color != last_selected_color){


//if((from_color != to_color) && (from_color != "m")){
var in2 = document.getElementById(last_selected_id);

//var from_piece = JSON.stringify(board[in2.className]);
//var to_piece = JSON.stringify(board[out2.className]);


//var last_selected = board[in2.id];
//var selected = board[out2.id];


//var here = innerhtml[in2.id].indexOf(".png");
//var there = innerhtml[out2.id].indexOf(".png");
//var from_piece = innerhtml[in2.id].slice(10,here);
//var to_piece = innerhtml[out2.id].slice(10,there);

console.log("last_selected_id: " + last_selected_id);
console.log("out2.id: " + out2.id);



if(last_selected != "marker" && selected == "marker" && last_selected != selected){
// to_ele,from_ele,to_id,from_id
move_piece(out2,in2,out2.id,in2.id,in2,out2);

}
else
{
if(last_selected_color != selected_color && selected != "marker"){
// to_ele,from_ele,to_id,from_id
take_piece(out2,in2,out2.id,in2.id,in2,out2);




}

if(last_selected_color == selected_color){
// to_ele,from_ele,to_id,from_id
console.log("whose_turn: " + whose_turn);
console.log('inside : last_selected_color == selected_color');
}
}
}

itr++;
last_selected_id = id;
console.log("from_piece: " + last_selected);
console.log("to_piece: " + selected);
undo=0;
//console.log("board: " + JSON.stringify(board));

//for each in board 
//mystring = mystring.split('/r').join('/')

//var x;
//for(x in board){x = x.replace(/\//g,'');}


//x = x.split('\\').join('');


// /board.forEach(function(x){}
//console.log("piece: " + piece);
//from = "start";
//to = "start";
//turn = 0;
//from_itr = 0;

//}


/*
//if(selected != "marker" && itr != 0 && turn != 0 && (from_color != "m")){
if(selected != "marker" && (from_color != "m")){
from = out2.id;
from_color = w_b_m(from);
if(from_color == "m"){from = ""; console.log("from_color: " + from_color);}
//if(from != "start"){from_color = w_b_m(from);}
//console.log("piece: " + piece);
//console.log("from: " + from);
from_itr = 1;
console.log("from_color: " + from_color);
console.log("from_itr: " + from_itr);
}

*/

//to_color != from_color

//turn = 1;


//selected = "start";


//var piece = JSON.stringify(board[classname]);
//console.log("piece: " + piece);

//selected = "marker";
//}
}
var lamdalink = document.getElementById(id);
lamdalink.addEventListener("mouseover", function(e){var target = e.target || e.srcElement; hover(id)}, false);
lamdalink.addEventListener("mouseleave", function(e){var target = e.target || e.srcElement; leave(id)}, false);
lamdalink.addEventListener("click", function(e){var target = e.target || e.srcElement; execute_z(id)}, false);
}

var undo = document.getElementById("undo");
undo.addEventListener("mouseover", function(e){var target = e.target || e.srcElement; hover("undo")}, false);
undo.addEventListener("mouseleave", function(e){var target = e.target || e.srcElement; leave("undo")}, false);
undo.addEventListener("click", function(e){var target = e.target || e.srcElement; take_back()}, false);


/*
//basename,innerhtml,id,classname
lamda_link('base',innerhtml['_8A'],'_8A','_8A');  
lamda_link('base',innerhtml['_8B'],'_8B','_8B');
lamda_link('base',innerhtml['_8C'],'_8C','_8C');
lamda_link('base',innerhtml['_8D'],'_8D','_8D');
lamda_link('base',innerhtml['_8E'],'_8E','_8E');
lamda_link('base',innerhtml['_8F'],'_8F','_8F');
lamda_link('base',innerhtml['_8G'],'_8G','_8G');
lamda_link('base',innerhtml['_8H'],'_8H','_8H');

lamda_link('base',innerhtml['_7A'],'_7A','_7A');
lamda_link('base',innerhtml['_7B'],'_7B','_7B');
lamda_link('base',innerhtml['_7C'],'_7C','_7C');
lamda_link('base',innerhtml['_7D'],'_7D','_7D');
lamda_link('base',innerhtml['_7E'],'_7E','_7E');
lamda_link('base',innerhtml['_7F'],'_7F','_7F');
lamda_link('base',innerhtml['_7G'],'_7G','_7G');
lamda_link('base',innerhtml['_7H'],'_7H','_7H');

lamda_link('base',innerhtml['_6A'],'_6A','_6A');  
lamda_link('base',innerhtml['_6B'],'_6B','_6B');
lamda_link('base',innerhtml['_6C'],'_6C','_6C');
lamda_link('base',innerhtml['_6D'],'_6D','_6D');
lamda_link('base',innerhtml['_6E'],'_6E','_6E');
lamda_link('base',innerhtml['_6F'],'_6F','_6F');
lamda_link('base',innerhtml['_6G'],'_6G','_6G');
lamda_link('base',innerhtml['_6H'],'_6H','_6H');

lamda_link('base',innerhtml['_5A'],'_5A','_5A');
lamda_link('base',innerhtml['_5B'],'_5B','_5B');
lamda_link('base',innerhtml['_5C'],'_5C','_5C');
lamda_link('base',innerhtml['_5D'],'_5D','_5D');
lamda_link('base',innerhtml['_5E'],'_5E','_5E');
lamda_link('base',innerhtml['_5F'],'_5F','_5F');
lamda_link('base',innerhtml['_5G'],'_5G','_5G');
lamda_link('base',innerhtml['_5H'],'_5H','_5H');

lamda_link('base',innerhtml['_4A'],'_4A','_4A');
lamda_link('base',innerhtml['_4B'],'_4B','_4B');
lamda_link('base',innerhtml['_4C'],'_4C','_4C');
lamda_link('base',innerhtml['_4D'],'_4D','_4D');
lamda_link('base',innerhtml['_4E'],'_4E','_4E');
lamda_link('base',innerhtml['_4F'],'_4F','_4F');
lamda_link('base',innerhtml['_4G'],'_4G','_4G');
lamda_link('base',innerhtml['_4H'],'_4H','_4H');  

lamda_link('base',innerhtml['_3A'],'_3A','_3A');
lamda_link('base',innerhtml['_3B'],'_3B','_3B');
lamda_link('base',innerhtml['_3C'],'_3C','_3C');
lamda_link('base',innerhtml['_3D'],'_3D','_3D');
lamda_link('base',innerhtml['_3E'],'_3E','_3E');
lamda_link('base',innerhtml['_3F'],'_3F','_3F');
lamda_link('base',innerhtml['_3G'],'_3G','_3G');
lamda_link('base',innerhtml['_3H'],'_3H','_3H');

lamda_link('base',innerhtml['_2A'],'_2A','_2A');
lamda_link('base',innerhtml['_2B'],'_2B','_2B');
lamda_link('base',innerhtml['_2C'],'_2C','_2C');
lamda_link('base',innerhtml['_2D'],'_2D','_2D');
lamda_link('base',innerhtml['_2E'],'_2E','_2E');
lamda_link('base',innerhtml['_2F'],'_2F','_2F');
lamda_link('base',innerhtml['_2G'],'_2G','_2G');
lamda_link('base',innerhtml['_2H'],'_2H','_2H');

lamda_link('base',innerhtml['_1A'],'_1A','_1A');
lamda_link('base',innerhtml['_1B'],'_1B','_1B');
lamda_link('base',innerhtml['_1C'],'_1C','_1C');
lamda_link('base',innerhtml['_1D'],'_1D','_1D');
lamda_link('base',innerhtml['_1E'],'_1E','_1E');
lamda_link('base',innerhtml['_1F'],'_1F','_1F');
lamda_link('base',innerhtml['_1G'],'_1G','_1G');
lamda_link('base',innerhtml['_1H'],'_1H','_1H');
*/
</script>
</body>
</html>
